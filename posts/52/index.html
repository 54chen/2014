<html class="no-js" lang="en">
<!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>五四陈科学院</title>
    <meta name="author" content="54chen">
  
    
    <meta name="description" content="公开了bbsdown的源代码下载 2008-11-23 00:00:00 +0800 下载地址：http://www.54chen.com/bbsdown 一个小工具，在学校的bbs里，许多时候限制上传2m大小的东西，如果要传大的附件的时候，都会分卷压缩了才上传，这样， …">
    
  
    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  
    
    <link rel="canonical" href="https://www.54chen.com/posts/52">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/fkwb.css?v6" type="text/css" rel="stylesheet">  
    <link href="/atom.xml" rel="alternate" title="五四陈科学院" type="application/atom+xml">
    	<link rel="apple-touch-icon" href="touch-icon.png">
  	<link rel="shortcut icon" href="/favicon.ico">
  
    
  
    <style type="text/css">.entry-content table {display: block;width: 100%;overflow: auto;word-break: normal;word-break: keep-all;}.entry-content table th {font-weight: bold;}.entry-content table th,.entry-content table td {padding: 6px 13px;border: 1px solid #ddd;}.entry-content table tr {background-color: #fff;border-top: 1px solid #ccc;}.entry-content table tr:nth-child(2n) {background-color: #f8f8f8;}</style>
  </head>
  
  <body>
    <header role="banner" class="banner_css"><a style="float:left" href="/"><img border="0" src="/images/54chen-logo.gif" alt="五四陈科学院-相信科学，分享技术." title="五四陈科学院-相信科学，分享技术.">
  </a>
  <div>
      <a href="/">首页</a>
      <a href="/blog/archives">归档</a>
      <a href="/video">视频</a>
      <a href="/about">关于</a>
  
      <a href="http://blog.54chen.com" style="color:white;font-size:9px">想找最新内容？</a>
  </div>
  <div class="subscription">
    
  <form action="https://www.54chen.com/cgi" method="get">
    <fieldset role="search">
      
      <input class="search" type="text" name="key" placeholder="Search">
    </fieldset>
  </form>
    
  
  </div>
  
  </header>
    <nav role="navigation"><ul class="subscription" data-subscription="rss">
    <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
    
  </ul>
    
  <form action="https://www.54chen.com/cgi" method="get">
    <fieldset role="search">
      
      <input class="search" type="text" name="key" placeholder="Search">
    </fieldset>
  </form>
    
    <li><a href="/">Blog</a></li>
    <li><a href="/blog/archives">Archives</a></li>
  
  </nav>
    <div id="main">
      <div id="content">
        <div class="blog-index">
    
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2008/11/23/%E5%85%AC%E5%BC%80%E4%BA%86bbsdown%E7%9A%84%E6%BA%90%E4%BB%A3%E7%A0%81%E4%B8%8B%E8%BD%BD/">公开了bbsdown的源代码下载</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2008-11-23T00:00:00+08:00" pubdate data-updated="true">2008-11-23 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p>下载地址：<a href="http://www.54chen.com/bbsdown">http://www.54chen.com/bbsdown</a></p>
  
  <p>一个小工具，在学校的<a href="http://www.54chen.com/c/38">bbs</a>里，许多时候限制上传2m大小的东西，如果要传大的附件的时候，都会分卷压缩了才上传，这样，一个页面里有很多的需要下载的东西，有多少个分卷就要点多少次下载。</p>
  
  <p>此工具就是解决这个问题，方便下载一个帖子里的所有分卷压缩包，只需要指定一个帖子的起始和结束页面地址，再加上压缩包的名字，<a href="http://www.54chen.com/bbsdown">bbsdown</a>就可以自己在后台全部下载在指定的目录内。</p>
  
  <p><img class="aligncenter" src="http://www.54chen.com/wp-content/uploads/2008/11/snap1.jpg" alt="" width="425" height="237"></p>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2008/11/23/%E4%B8%80%E9%83%A8%E9%9D%9E%E5%B8%B8%E5%A5%BD%E7%9A%84%E8%A7%86%E9%A2%91/">一部非常好的视频-</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2008-11-23T00:00:00+08:00" pubdate data-updated="true">2008-11-23 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p>这是《》的视频 是一部有深刻教育意义的影片</p>
  
  <p>一共七集</p>
  
  <p><object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="400" height="300" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="src" value="http://vhead.blog.sina.com.cn/player/outer_player.swf?auto=1&amp;vid=12169755&amp;uid=1295293825">
<embed type="application/x-shockwave-flash" width="400" height="300" src="http://vhead.blog.sina.com.cn/player/outer_player.swf?auto=1&amp;vid=12169755&amp;uid=1295293825"></embed></object></p>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2008/11/21/%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E4%BD%BF%E7%94%A8plproxy%E7%9A%84postgresql%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9B%86%E7%BE%A4/">配置一个使用plproxy的PostgreSQL数据库集群</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2008-11-21T00:00:00+08:00" pubdate data-updated="true">2008-11-21 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p>本文只有一个连接 没有那么多内容</p>
  
  <p><a href="http://www.pgsqldb.org/mwiki/index.php/%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AA%E4%BD%BF%E7%94%A8plproxy%E7%9A%84PostgreSQL%E6%95%B0%E6%8D%AE%E5%BA%93%E9%9B%86%E7%BE%A4">http://www.pgsqldb.org/mwiki/index.php/配置一个使用plproxy的PostgreSQL数据库集群</a></p>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2008/11/21/%E5%BD%93pg%E8%BF%9E%E6%8E%A5%E6%95%B0%E8%BE%BE%E5%88%B0%E4%B8%80%E5%AE%9A%E6%95%B0%E9%87%8F%E6%97%B6%EF%BC%8Cpgsql%E8%BF%9B%E7%A8%8B%E4%BC%9A%E7%BB%88%E6%AD%A2%EF%BC%8C%E6%8A%A5out-of-memory/">当Pg连接数达到一定数量时，Pgsql进程会终止，报Out of Memory</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2008-11-21T00:00:00+08:00" pubdate data-updated="true">2008-11-21 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p>Q： 当Pg连接数达到一定数量时，Pgsql进程会终止，报Out of memory<br>
  A：在 Linux 2.4  以及之后的版本里，缺省的虚拟内存的设置对于  PgSQL而言不是最优的(32M)。原因也可能在于内核实现内存提交的方法导致出现了“过提交”内存（具体情况由于没有遇到，不作评述），如果其它进程的内存请求导致系统用光虚拟内存，那么内核可能会立即终止  PGSQL 服务器进程并会出具Out of memory报错，唯一的解救方法只能手工kill掉数据库进程，重启数据库。修改方法为：
  </p>
<pre>sysctl -w kernel.shmmax=134217728
  sysctl -w kernel.shmall=2097152
  sysctl -w vm.overcommit_memory=2</pre>
  或者直接echo进proc中去（我个人喜欢比较传统的作）
  <pre>echo 134217728 &gt;/proc/sys/kernel/shmmax
  echo 2097152 &gt;/proc/sys/kernel/shmall
  echo 2 &gt; /proc/sys/vm/overcommit_memory</pre>
  考虑到并不是每个人都乐意于每次开机都作此作，最好还是修改/etc/sysctl.config文件添加相应的设置。
  
  <p><a name="Slony.E4.B8.8D.E5.90.8C.E6.AD.A5.E6.95.B0.E6.8D.AE.EF.BC.9F"></a>
  </p>
<h3><span class="mw-headline">Slony不同步数据？ </span></h3>
  Q：配置了Slony,并未报错，但数据没同步过来<br>
  A：你要同步的表都设置主键了么，如果没有设主键的Slony配置表的属性的时候要加Serial属性哦
  
  <p><a name="Slony.E5.90.8C.E6.AD.A5.E6.95.B0.E6.8D.AE.E9.9D.9E.E5.B8.B8.E6.85.A2.EF.BC.9F"></a>
  </p>
<h3><span class="mw-headline">Slony同步数据非常慢？ </span></h3>
  Q：Slony同步数据非常慢，需要20~30s，且配置Slony的机器上cpu消耗严重？<br>
  A：检查slony同步的时间间隔，默认是10000微妙，这个数值还不错，别设置太低了。
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2008/11/21/%E4%BD%BF%E7%94%A8plproxy%E5%92%8Cpgbouncer%E5%AE%8C%E6%88%90%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/">使用plproxy和pgbouncer完成分布式处理</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2008-11-21T00:00:00+08:00" pubdate data-updated="true">2008-11-21 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p> </p>
  
  <p>plproxy和pgbouncer都是skype开发的基于<a href="http://www.54chen.com/c/105">postgresql</a>的开源应用；前者主要用于完成分布式计算，后者主要充当数据库连接池；它们的主页在[<a class="external text" title="https://developer.skype.com/SkypeGarage/DbProjects/PlProxy" rel="nofollow" href="https://developer.skype.com/SkypeGarage/DbProjects/PlProxy" target="_blank">plproxy</a>]和[<a class="external text" title="https://developer.skype.com/SkypeGarage/DbProjects/PgBouncer" rel="nofollow" href="https://developer.skype.com/SkypeGarage/DbProjects/PgBouncer" target="_blank">pgbouncer</a>] </p>
  
  <p><span class="mw-headline">plproxy的特性</span></p>
  
  <p> <br>
  	</p>
<li>使用plproxy类似于RPC；假设我们有A,B两台数据库，在A在创建一个plproxy的function，并指定一些参数和返回值，就可以在B上也创建一个同名的pgsql函数，并指定同样的参数和返回值；这样，在A上调用该function，通过适当地声明，就可以实现在B上调用该函数的同样效果，但结果是在A上返回的；</li>
  	<li>plproxy还能合并多个结点服务器上返回的结果集，就像是这些结果是由一个函数产生的一样，方便客户端作；</li>
  	<li>plproxy可以指定同时在所有结点服务器上执行作，或者只在指定的几台服务器上作，或者只在任意一台结点服务器上执行作；</li>
  	<li>plproxy默认是自动提交的；也就是说，只要目标服务器的函数执行成功了，它就会提交；这样有可能造成各个结点数据库的状态并不一致；因为可能有的结点执行成功了，有的没有执行成功，但plproxy并不会因为一个结点失败就回滚其它结点的作</li>
  一开始，我们只有一台账户数据库；但随着账户增加，单个数据库肯定满足不了需求；当多台数据库服务器并存的情况下，需要解决负载平衡的问题；
  
  <p>为此，我们在系统的syshostconfig表中存储了一个key为accountNum，value为整数的参数；每次进行作时，先用plproxy在所有数据库上查出该值并返到proxy层；由pgsql函数找出哪个数据库的accountNum最小，然后就在该数据库上，并将对应的accountNum加1</p>
  
  <p>这样，新增服务器将立即开始承担新用户的注册；原有服务器压力不变； </p>
  
  <p><span class="mw-headline">plproxy中的死锁</span></p>
  
  <p>考虑两个账户a@a.com和b@b.com，如果出现a@a.com向b@b.com转账，恰好b@b.com也在向a@a.com转账，就会出现死锁的情况；即一个进程已经拿到a@a.com的锁，并等待b@b.com，而另一个进程拿到了b@b.com的锁，并等待a@a.com；</p>
  
  <p>一个可行的解决办法就是所有作都按照一个可以预见的顺序进行；也就是限制转账作的交易顺序，通过对交易双方的账号进行排序是一个较为简单的办法；</p>
  
  <p>针对以上问题，如果我们限制对a@a.com的作，无论是付款还是收款都优先作，而b@b.com永远都排在它后面，也就解决了死锁的问题；</p>
  
  <p>因此，在转账交易中，首要任务是对账户名进行排序；至于先收款还先付款，其实不重要</p>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2008/11/21/postgresql%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85linux/">PostgreSQL系统安装(Linux)</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2008-11-21T00:00:00+08:00" pubdate data-updated="true">2008-11-21 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p></p>
<li>1. 到 <a class="external text" title="http://www.postgresql.org/" rel="nofollow" href="http://www.postgresql.org/" target="_blank">http://www.postgresql.org</a>下载pg8.2.4 source</li>
  	<li>2. 编译安装<a href="http://www.54chen.com/c/101">pgsql</a>
  <ul>
  	<li>tar xvfj postgresql-8.2.4.tar.bz2</li>
  	<li>cd postgresql-8.2.4</li>
  	<li>./configure --prefix=/home/y/pgsql #注意下一步把这个目录加入你bash的PATH中去</li>
  	<li>gmake</li>
  	<li>sudo gmake install</li>
  	<li>sudo mkdir /home/y/pgsql/data</li>
  	<li>sudo chown yahoo /home/y/pgsql/data</li>
  	<li>sudo -u yahoo /home/y/pgsql/bin/initdb --locale=zh_CN.UTF-8 --encoding=utf8  -D /home/y/pgsql/data</li>
  </ul>
  </li>
  	<li>3.创建数据库
  <ul>
  	<li>cd /home/y/pgsql/bin</li>
  	<li>sudo -u yahoo ./pg_ctl start -D /home/y/pgsql/data #启动服务进程</li>
  	<li>sudo -u yahoo /home/y/pgsql/bin/createdb test　#创建数据库test</li>
  	<li>sudo -u yahoo /home/y/pgsql/bin/psql test</li>
  	<li>test=# create role changxin superuser login ;</li>
  	<li>test=# \q</li>
  	<li>备注：现在就可以直接登入test数据库进行作了。并且我的权限是最大权限的superuser。 </li>
  </ul>
  </li>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2008/11/21/plproxy%E9%83%A8%E7%BD%B2%E6%89%8B%E5%86%8C/">Plproxy部署手册</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2008-11-21T00:00:00+08:00" pubdate data-updated="true">2008-11-21 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p></p>
<dt>安装过程如下： </dt>
<dt>1 安装<a href="http://www.54chen.com/c/109">plproxy</a>：下载<a class="external text" title="http://pgfoundry.org/frs/download.php/1919/plproxy-2.0.7.tar.gz" rel="nofollow" href="http://pgfoundry.org/frs/download.php/1919/plproxy-2.0.7.tar.gz" target="_blank">plproxy</a>.安装完成plproxy后,运行{$PATH_TO_PG}/share/contrib/plproxy.sql </dt>
<dt>2 建立数据库_proxy； </dt>
<dt>3 建立plpgsql语言； </dt>
<dt>4 在_proxy中建立模式plproxy;分配权限 grant all on schema plproxy to &lt;用户&gt;。 </dt>
<dt>5 建立pgcluster； </dt>
<dt>
  </dt>
<dt>
  <pre> --以上步骤sql语句：
   CREATE FUNCTION plpgsql_call_handler () RETURNS language_handler AS
       '/usr/local/pgsql/lib/plpgsql.so'  LANGUAGE C;</pre>
</dt>
  
  <p> CREATE FUNCTION plpgsql_validator(oid) RETURNS void AS<br>
       '/usr/local/pgsql/lib/plpgsql.so'  LANGUAGE C;</p>
  
  <p> CREATE TRUSTED PROCEDURAL LANGUAGE 'plpgsql'<br>
       HANDLER plpgsql_call_handler<br>
       VALIDATOR plpgsql_validator;</p>
  
  <p> --------------------------------------------------------------------</p>
  
  <p> drop schema if exists plproxy cascade;</p>
  
  <p> create schema plproxy;</p>
  
  <p> grant all on schema plproxy to yahoo;</p>
  
  <p> --------------------------------------------------------------------<br>
   create or replace function plproxy.get_cluster_version(cluster_name text)</p>
  
  <p> returns integer as $$</p>
  
  <p> begin<br>
       if cluster_name = '&lt;cluster名字&gt;' then</p>
  
  <p> 	return 8;</p>
  
  <p>     end if;</p>
  
  <p>     raise exception 'no such cluster: %', cluster_name;</p>
  
  <p> end; $$ language plpgsql;</p>
  
  <p> --------------------------------------------------------------------  <br>
   create or replace function plproxy.get_cluster_partitions(cluster_name text)</p>
  
  <p> returns setof text as $$</p>
  
  <p> begin</p>
  
  <p>    if cluster_name = '&lt;cluster名字&gt;' then</p>
  
  <p> 	--return next 'host=202.165.97.144 port=6000 user=chry password=chry dbname=chry_134';</p>
  
  <p> 	return next 'host=pg1.sns.cn3.yahoo.com user=yahoo dbname=sns_search';<br>
   	return next 'host=pg2.sns.cn3.yahoo.com user=yahoo dbname=sns_search';</p>
  
  <p> 	return;</p>
  
  <p>     end if;</p>
  
  <p>     raise exception 'no such cluster: %', cluster_name;</p>
  
  <p> end; $$ language plpgsql;</p>
  
  <p> --------------------------------------------------------------------<br>
   create or replace function plproxy.get_cluster_config(cluster_name text, out key text, out val text)</p>
  
  <p> returns setof record as $$</p>
  
  <p> begin</p>
  
  <p>     key := 'statement_timeout';</p>
  
  <p>     val := 60;</p>
  
  <p>     return next;</p>
  
  <p>     return;</p>
  
  <p> end; $$ language plpgsql;
  </p>
<pre></pre>
<dl>
  <dt>6 建立查询函数 </dt>
</dl>
  <pre> --在_proxy中建立查询函数:
   CREATE OR REPLACE FUNCTION public.doquery(query text)
   RETURNS setof record AS $$
   CLUSTER '&lt;cluster名字&gt;';
   RUN ON ALL;
   $$ LANGUAGE plproxy;</pre>
  
  <p> --------------------------------------------------------------------<br>
   CREATE OR REPLACE FUNCTION public.doquery(urlstr text,query text)<br>
   RETURNS setof record AS $$<br>
   CLUSTER '&lt;cluster名字&gt;';<br>
   RUN ON hashtext(urlstr);<br>
   $$ LANGUAGE plproxy;</p>
  
  <p> --------------------------------------------------------------------  <br>
   CREATE OR REPLACE FUNCTION public.dmlExec(query text)<br>
   RETURNS integer AS $$<br>
   CLUSTER '&lt;cluster名字&gt;';<br>
   RUN ON ALL;<br>
   $$ LANGUAGE plproxy;</p>
  
  <p> --------------------------------------------------------------------<br>
   CREATE OR REPLACE FUNCTION public.dmlExec(urlstr text,query text)<br>
   RETURNS integer AS $$<br>
   CLUSTER '&lt;cluster名字&gt;';<br>
   RUN ON hashtext(urlstr);<br>
   $$ LANGUAGE plproxy;
   
  </p>
<pre> --在所联邦的数据库中建立查询函数:
   CREATE OR REPLACE FUNCTION public.doquery(query text)
   RETURNS SETOF RECORD AS $$
   DECLARE
   row RECORD;
   BEGIN
   for row in execute query loop
   return next row;
   end loop;
   return;
   END;
   $$ LANGUAGE plpgsql;</pre>
  
  <p> ----------------------------------------------------------------<br>
   CREATE OR REPLACE FUNCTION public.doquery(urlstr text,query text)<br>
   RETURNS SETOF RECORD AS $$<br>
   DECLARE<br>
   row RECORD;<br>
   BEGIN<br>
   for row in execute query loop<br>
   return next row;<br>
   end loop;<br>
   return;<br>
   END;<br>
   $$ LANGUAGE plpgsql;</p>
  
  <p> ----------------------------------------------------</p>
  
  <p> CREATE OR REPLACE FUNCTION public.dmlExec(query text)<br>
   RETURNS integer AS $$<br>
   DECLARE<br>
   ret integer;<br>
   BEGIN<br>
   execute query;</p>
  
  <p> GET DIAGNOSTICS ret = ROW_COUNT;<br>
   RETURN ret;</p>
  
  <p> END;<br>
   $$ LANGUAGE plpgsql;</p>
  
  <p> ---------------------------------------------------------------<br>
   CREATE OR REPLACE FUNCTION public.dmlExec(urlstr text,query text)<br>
   RETURNS integer AS $$<br>
   DECLARE<br>
   ret integer;<br>
   BEGIN<br>
   execute query;</p>
  
  <p> GET DIAGNOSTICS ret = ROW_COUNT;<br>
   RETURN ret;</p>
  
  <p> END;<br>
   $$ LANGUAGE plpgsql;
  
  </p>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2008/11/21/pgsql%E5%A6%82%E4%BD%95%E6%8E%A7%E5%88%B6%E6%9D%A5%E8%87%AA%E5%85%B6%E4%BB%96%E7%94%B5%E8%84%91%E7%9A%84%E8%BF%9E%E6%8E%A5%EF%BC%9F/">Pgsql如何控制来自其他电脑的连接？</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2008-11-21T00:00:00+08:00" pubdate data-updated="true">2008-11-21 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p></p>
<ul>
  	<li>缺省情况下，<a href="http://www.54chen.com/c/101">PostgreSQL</a>只允许来自本机且通过 unix  域套接字或TCP/IP方式的连接。你只有在修改了配置文件postgresql.conf中的listen_addresses，且也在配置文件$PGDATA/pg_hba.conf中打开了  基于远程电脑（ host-based ）的身份认证，并重新启动<a href="http://www.54chen.com/c/101">PostgreSQL</a>，否则其他电脑是不能与你的<a href="http://www.54chen.com/c/101">PostgreSQL</a>服务器进行<a href="http://www.54chen.com/c/89">连接</a>的。</li>
  	<li>将postgresql.conf中的listen_addresses设为：listen_addresses = '*'</li>
  	<li>在pg_hba.conf中加入访问<a href="http://www.54chen.com/c/89">数据库</a>的服务器的IP。如，IP=10.62.130.136，在pg_hba.conf的最后加入 host all  all 10.62.130.136/32 trust</li>
  </ul>
  <!-- end content -->
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2008/11/21/pgpool%E5%AE%89%E8%A3%85/">Pgpool安装</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2008-11-21T00:00:00+08:00" pubdate data-updated="true">2008-11-21 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p></p>
<pre class="cmd">下载地址：http://pgfoundry.org/projects/pgpool/
  文件为：pgpool-II-2.0.1.tar，tar xvfj pgpool-II-2.0.1.tar
  在pgpool-II-2.0.1目录下，执行./configure --prefix=/home/y/share/pgsql ----with-pgsql=/home/y/share/pgsql,
  要求with-pgsql目录必须为<a href="http://www.54chen.com/c/101">pgsql</a>安装目录。
  之后执行gmake,sudo gmake install;
  pgpool需要用PCP命令来连接数据库检索数据，其用户名、密码是在pcp.conf文件中保存的。密码是经过md5加密的，需要用户手工输入。
  cp /home/y/share/pgsql/etc/pcp.conf.sample /home/y/share/pgsql/etc/pcp.conf
  md5加密码可以用/home/y/share/pgsql/bin/pg_md5直接生成 ：例/home/y/share/pgsql/bin/pg_md5 postgres 
  结果为e8a48653851e28c69d0506508fb27fc5
  将用户名，密码记入到pcp.conf文件中。
  pcp默认端口为pcp_port = 9898。可以在pgpool.conf文件内修改
  cp /home/y/share/pgsql/etc/pgpool.conf.sample /home/y/share/pgsql/etc/pgpool.conf,默认连接端口为port = 9999，
  默认只允许本地连接，listen_addresses = 'localhost'，
  如果需要所有ip可连接，可改为listen_addresses = '*'。
  cp /home/y/share/pgsql/etc/pool_hba.conf.sample /home/y/share/pgsql/etc/pool_hba.conf,</pre>
  
  <p>添加远端连接 host    all    all     0.0.0.0/0   trust.</p>
  
  <p>添加pgsql节点<br>
  backend_hostname0 = 'phx6.sds.cnb.yahoo.com'<br>
  backend_port0 = 5432<br>
  backend_weight0 = 1<br>
  backend_hostname1 = 'phx7.sds.cnb.yahoo.com'<br>
  backend_port1 = 5432<br>
  backend_weight1 = 1</p>
  
  <p>如果需要开启多级拷贝功能需要设置replication_mode = true<br>
  如果需要开启负载均衡功能需要设置load_balance_mode = true</p>
  
  <p>启动pgpool<br>
  pgpool -n -d &gt; /tmp/pgpool.log 2&gt;&amp;1 &amp;<br>
  关闭pgpool<br>
  pgpool stop</p>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2008/11/20/%E7%BD%91%E6%98%93%E5%BC%BA%E4%BA%BA%E8%A7%86%E9%A2%91/">TA 们放肆摇晃的青春尾巴---龙城八月，有淫气。</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2008-11-20T00:00:00+08:00" pubdate data-updated="true">2008-11-20 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p><object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="534" height="344" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="src" value="http://swf.news.163.com/flvplayer081029/~false~v_4QAG1LMG~v.2008.163.com/img/snapshot/M/G/v_4QAG1LMG_m~.swf">
<embed type="application/x-shockwave-flash" width="534" height="344" src="http://swf.news.163.com/flvplayer081029/~false~v_4QAG1LMG~v.2008.163.com/img/snapshot/M/G/v_4QAG1LMG_m~.swf"></embed></object><a href="http://swf.news.163.com/flvplayer081029/~false~v_4QAG1LMG~v.2008.163.com/img/snapshot/M/G/v_4QAG1LMG_m~.swf"></a></p>
  </div>
    
    
  
  
      </article>
    
  
  
  <div class="pagination">
    
      <a href="/posts/51">« Prev</a>
    
  
    
      
        <a href="/">1</a>
      
    
      
        <a href="/posts/2">2</a>
      
    
      
        <a href="/posts/3">3</a>
      
    
      
        <a href="/posts/4">4</a>
      
    
      
        <a href="/posts/5">5</a>
      
    
      
        <a href="/posts/6">6</a>
      
    
      
        <a href="/posts/7">7</a>
      
    
      
        <a href="/posts/8">8</a>
      
    
      
        <a href="/posts/9">9</a>
      
    
      
        <a href="/posts/10">10</a>
      
    
      
        <a href="/posts/11">11</a>
      
    
      
        <a href="/posts/12">12</a>
      
    
      
        <a href="/posts/13">13</a>
      
    
      
        <a href="/posts/14">14</a>
      
    
      
        <a href="/posts/15">15</a>
      
    
      
        <a href="/posts/16">16</a>
      
    
      
        <a href="/posts/17">17</a>
      
    
      
        <a href="/posts/18">18</a>
      
    
      
        <a href="/posts/19">19</a>
      
    
      
        <a href="/posts/20">20</a>
      
    
      
        <a href="/posts/21">21</a>
      
    
      
        <a href="/posts/22">22</a>
      
    
      
        <a href="/posts/23">23</a>
      
    
      
        <a href="/posts/24">24</a>
      
    
      
        <a href="/posts/25">25</a>
      
    
      
        <a href="/posts/26">26</a>
      
    
      
        <a href="/posts/27">27</a>
      
    
      
        <a href="/posts/28">28</a>
      
    
      
        <a href="/posts/29">29</a>
      
    
      
        <a href="/posts/30">30</a>
      
    
      
        <a href="/posts/31">31</a>
      
    
      
        <a href="/posts/32">32</a>
      
    
      
        <a href="/posts/33">33</a>
      
    
      
        <a href="/posts/34">34</a>
      
    
      
        <a href="/posts/35">35</a>
      
    
      
        <a href="/posts/36">36</a>
      
    
      
        <a href="/posts/37">37</a>
      
    
      
        <a href="/posts/38">38</a>
      
    
      
        <a href="/posts/39">39</a>
      
    
      
        <a href="/posts/40">40</a>
      
    
      
        <a href="/posts/41">41</a>
      
    
      
        <a href="/posts/42">42</a>
      
    
      
        <a href="/posts/43">43</a>
      
    
      
        <a href="/posts/44">44</a>
      
    
      
        <a href="/posts/45">45</a>
      
    
      
        <a href="/posts/46">46</a>
      
    
      
        <a href="/posts/47">47</a>
      
    
      
        <a href="/posts/48">48</a>
      
    
      
        <a href="/posts/49">49</a>
      
    
      
        <a href="/posts/50">50</a>
      
    
      
        <a href="/posts/51">51</a>
      
    
      
        <em>52</em>
      
    
      
        <a href="/posts/53">53</a>
      
    
      
        <a href="/posts/54">54</a>
      
    
      
        <a href="/posts/55">55</a>
      
    
      
        <a href="/posts/56">56</a>
      
    
  
    
      <a href="/posts/53">Next »</a>
    
  </div>
  
  
    <div class="pagination">
      <a href="/blog/archives">Blog Archives</a>
    </div>
  </div>
  <aside class="sidebar">
    
      
    
  </aside>
  
    </div>
    <footer role="contentinfo" class="footer_css">  <script src="/javascripts/modernizr-2.0.js"></script>
    <script src="/javascripts/libs/jquery.min.js"></script>
    <script src="/javascripts/octopress.js" type="text/javascript"></script>
    Copyright © 2017 - 54chen -
  
  </footer>
    
  
  
  
  
  
  
  
  
  
  </div>
</body>
  </html>
