<html class="no-js" lang="en">
<!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>五四陈科学院</title>
    <meta name="author" content="54chen">
  
    
    <meta name="description" content="人人网－英特尔技术专题讨论会实录 2009-12-30 00:00:00 +0800 Intel/Qianxiang server workshop
  （这横幅很搞 叫Qianxiang不如叫RenRen，千橡的英文：Oak Pacific）
  intel技术专家
  互联网大客户技术技术服务内容
  1. …">
    
  
    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  
    
    <link rel="canonical" href="https://www.54chen.com/posts/39">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/fkwb.css?v6" type="text/css" rel="stylesheet">  
    <link href="/atom.xml" rel="alternate" title="五四陈科学院" type="application/atom+xml">
    	<link rel="apple-touch-icon" href="touch-icon.png">
  	<link rel="shortcut icon" href="/favicon.ico">
  
    
  
    <style type="text/css">.entry-content table {display: block;width: 100%;overflow: auto;word-break: normal;word-break: keep-all;}.entry-content table th {font-weight: bold;}.entry-content table th,.entry-content table td {padding: 6px 13px;border: 1px solid #ddd;}.entry-content table tr {background-color: #fff;border-top: 1px solid #ccc;}.entry-content table tr:nth-child(2n) {background-color: #f8f8f8;}</style>
  </head>
  
  <body>
    <header role="banner" class="banner_css"><a style="float:left" href="/"><img border="0" src="/images/54chen-logo.gif" alt="五四陈科学院-相信科学，分享技术." title="五四陈科学院-相信科学，分享技术.">
  </a>
  <div>
      <a href="/">首页</a>
      <a href="/blog/archives">归档</a>
      <a href="/video">视频</a>
      <a href="/about">关于</a>
  
      <a href="http://blog.54chen.com" style="color:white;font-size:9px">想找最新内容？</a>
  </div>
  <div class="subscription">
    
  <form action="https://www.54chen.com/cgi" method="get">
    <fieldset role="search">
      
      <input class="search" type="text" name="key" placeholder="Search">
    </fieldset>
  </form>
    
  
  </div>
  
  </header>
    <nav role="navigation"><ul class="subscription" data-subscription="rss">
    <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
    
  </ul>
    
  <form action="https://www.54chen.com/cgi" method="get">
    <fieldset role="search">
      
      <input class="search" type="text" name="key" placeholder="Search">
    </fieldset>
  </form>
    
    <li><a href="/">Blog</a></li>
    <li><a href="/blog/archives">Archives</a></li>
  
  </nav>
    <div id="main">
      <div id="content">
        <div class="blog-index">
    
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2009/12/30/everyone-network-intel-technology-symposium-record/">人人网－英特尔技术专题讨论会实录</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2009-12-30T00:00:00+08:00" pubdate data-updated="true">2009-12-30 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p>Intel/Qianxiang server workshop<br>
  （这横幅很搞 叫Qianxiang不如叫<a href="http://www.54chen.com/architecture/54-chen-skills-the-whole-point-for-domain-names-using-nginx-and-javascript-to-do-a-simple-jump-to-inform-the-friendly-exchange-of-domain-names.html">RenRen</a>，千橡的英文：Oak Pacific）<br>
  intel技术专家<br>
  互联网大客户技术技术服务内容<br>
  1.idc机房相关<br>
  2.性能优化：调试、锁等基础知识</p>
  
  <p>下面由请intel技术专家：一个阿姨先讲话，可能是，无自我介绍<br>
  数据中心专家：张静、oracle专家津鹏、泰勒、优化组的徐进<br>
  （以上纯音译）</p>
  
  <p>泰勒说话<br>
  性能技术分享
  <a href="http://www.54chen.com/uncategorized/technical-test-you-are-oltp-application-in-the-development-of-pro.html">cpu</a> 至强服务器优化产品</p>
  
  <p>数据中心 Optimized Datacenters</p>
  
  <p>技术专家津鹏开始说话<br>
  国内普通机房2.2kw-3kw每机柜<br>
  放视频：英特尔原料的一个生产厂 现在是一个数据中心 一个三层的楼 （真TM大） 视频里一个老外一层一层地介绍 每机柜30kw（国内的十倍）（听不懂老外在介绍啥，没有字幕，一帮人在看纯视频）</p>
  
  <p>视频放完</p>
  
  <p>在研究散热与机柜</p>
  
  <p>张静开始<br>
  PPT<br>
  数据中心未来的发展和案例分析<br>
  从九六年到零九年的服务器成本的柱状图。power &amp; cooling的费用在增长。<br>
  数据中心：可靠性、可扩容性、管理<br>
  神奇了（第一个大哥讲了半天，第二个大哥上来说PPT是他准备的。。。）</p>
  
  <p>津鹏大哥来说话了<br>
  数据分散<br>
  数据中心要求越高、成本越高、建的时间就越长。<br>
  运营数据中心与灾备数据中心。</p>
  
  <p>张静大哥又回来了<br>
  数据中心的需求与建设的花费的策略：考虑未来几年的增长<br>
  空调的增加更加容易：逐渐投入<br>
  超级用户：类似腾讯，模块化的数据中心建设.集装箱数据中心。快速实施。<br>
  如何在数据中心里节能：PUE Data Center Power Usage Effectiveness<br>
  SPUE<br>
  TPUE = PUE+SPUE<br>
  目前通常在3.2<br>
  一个数据中心基本上只有三分之一是用来计算的。<br>
  1.使用更高效率的电源。80PLUS 铜 银 金<br>
  2.（UPS有三次电源转换：整流器 逆变器 变压器）英特尔在佬实验中取消了<a href="http://www.54chen.com/memo/%e5%9d%90%e9%98%b5%e6%9d%ad%e5%b7%9e%e6%b7%98%e5%ae%9d.html">UPS</a> （高压直流供电）<br>
  3.气流与温度<br>
  冷气流不够 上半部分服务器过热<br>
  风量过大 风速过大 冷空气短路（只有一半的温度降了），下面的解决办法：<br>
  1.封闭冷通道改变冷气流风向 可节能36％ 温差变大后更能节能50％<br>
  2.烟窗式机柜</p>
  
  <p>水冷</p>
  
  <p>打了下瞌睡<br>
  现在是津鹏大哥在讲集装箱机房<br>
  案例：一家佬上市的国内顶级的互联网公司 我猜是百度<br>
  评估一个数据中心的好与坏</p>
  
  <p>最后又是一个视频：的集装箱数据中心 有个<a href="http://www.54chen.com/memo/%e5%9d%90%e9%98%b5%e6%9d%ad%e5%b7%9e%e6%b7%98%e5%ae%9d.html"></a>的兄弟穿个MAIL的Tshirt很cool</p>
  
  <p>津鹏这哥们播视频用的QQ影音</p>
  
  <p>===<br>
  徐进大哥上台，这兄弟来过一回，讲<a href="http://www.54chen.com/_linux_/linux-system-replacement-method-sshd-notes-from-from-academy-of-sciences.html">CPU</a>
  ASE全球对云计算／互联网数据中心的支持<br>
  这兄弟讲课老是晃<br>
  解决性能缺陷：概念和方法及策略<br>
  一个表，按获益排序：1.系统级（网络磁盘内存）  2.应用级（进程堆数据结构）  3.微架构级（微架构级优化指令集） 越前面的策略获益越高 难度越低</p>
  
  <p>intel tools&amp;libraries;<br>
  线程级并行：Thread Building Block Open Standards OpenMP<br>
  数据并行：Ct,C/C++ Stds</p>
  
  <p>2008年的硬件概述<br>
  理论计算能力：102.4G指令／秒<br>
  实际只是三分之一到二分之一，经常是四分之一或者五分之一<br>
  2009年的硬件概述<br>
  理论计算能力：不变<br>
  内存带宽提高了3倍：6通道DDR3：64G／s<br>
  硬盘系统 SSD RAID5＊6： IOPS：100，000（上百倍提升） SSD写性能远差于自己的读性能1：100 但也比传统的高<br>
  SSD随机读性能非常好 随机写一般</p>
  
  <p>BIOS设置：－SMT／EIST／NUMA／Prefetcher<br>
  NUMA:不跨CPU访问内存 尽量不调度原来的CPU上的指令</p>
  
  <p>SSD VS HD<br>
  一般情况下，索引文件都比较大。<br>
  在更新索引文件的过程中，磁盘压力较大，SSD能获得较好性能。</p>
  
  <p>应用级的性能缺陷<br>
  多核环境下，多线程程序的设计需要非常细致的设计<br>
  －锁的粒度<br>
  －并发<br>
  －软件流水线的设计<br>
  －选择合适的线程库（TBB）</p>
  
  <p>锁的粒度<br>
  一个例子，对应用程序内部的缓存加锁造成的线程冲突，将缓存拆分成多个部分，分别加以保护，大大缓解了冲突，应用程序性能提高了21％</p>
  
  <p>典型的应用性能缺陷<br>
  滥用STL：滥用可能会造成非常密集的内存管理作；多线程环境下会更坏<br>
  Glibc的malloc/free在多核环境下扩展性很差、如果在多线程环境下需要频繁分配和释放内存，可以考虑SmartHeap(收费的)\hoard\intel TBB<br>
  内存作：memcpy memset是耗时的，特别是在Xeon E5400平台上，每秒memcpy/memset 2GB将会对整个系统的性能造成极大的影响。<br>
  Bitmap:随机写位图的某些图，如果造成了缓存缺失每次访问都能造成上百个CPU cycle（一个小循环里写10W到20W次，读没有关系）</p>
  
  <p>算法的选择
  <a href="http://www.54chen.com/architecture/wordpress-nginx-php-cgi-mysql-memory-in-the-128m-to-install-and-optimize-the-vps-notes.html">JPEG</a>缩略图生成<br>
  通过在频率域减采样可以将原图非常快的缩小到1／（2的N次方）大小，然后再缩小到合适的大小，与直接缩小相比，性能提高了2.5倍（校内相册吕威大侠曾经说过，我记得是2.8倍）<br>
  加密算法AES VS TEA<br>
  AES比TEA要快3倍以上<br>
  搜索引擎中，为了减少磁盘访问，通常倒排表被压缩后存放，SSE4.2优化后的PForDelta算法可以达到3GB／s的解压速度，是VBYTE速度的10倍，而压缩率更好。</p>
  
  <p>采取正确的IO API<br>
  SSD的IO延迟很小，并且能同时处理几十个IO请求，单线程上的同步IO不能最大化发SSD的性能。<br>
  要SSD发挥到最大，要使用许多个线程去同步作SSD。<br>
  BufferIO会造成内核的内存拷贝，如果需要每秒处理上GB的磁盘读作，则需要考虑是否需要采用Direct-IO mmap等无需拷贝的方式。<br>
  当文件大于系统内存的情况下，通过mmap的方式随机的访问会造成频繁缺页。</p>
  
  <p>采用高性能库函数<br>
  intel ipp库：<a href="http://www.54chen.com/cc/php-java-c-upload-files-how-to-accurately-determine-the-file-type-mime-literacy.html">JPEG</a> resize IPP是libjpeg的2部<br>
  Westmere上新的AES指令可以提供10倍于普通AES的性能，IPP将会在第一时间提供支持。</p>
  
  <p>例子：用SSE4.2优化P_FOR_dELTA解压缩 很复杂 看不懂</p>
  
  <p>＝＝＝<br>
  四个内部案例<br>
  分享时间：小白 铁安 军辉</p>
  
  <p>passport优化 小白</p>
  
  <p>以前的情况<br>
  read-&gt;mysql-&gt;loginCache-&gt;write<br>
  Ice.Server.ThreadPool<br>
  第三个阶段非常慢，用户登录不上。</p>
  
  <p>现在<br>
  read<br>
  Ice.Server.ThreadPool<br>
  mysql-&gt;loginCache-&gt;write<br>
  另一个pool</p>
  
  <p>延长二十分钟在线，从产品上解决问题。</p>
  
  <p>新鲜事重构 铁安<br>
  文件存储<br>
  索引存储4－5W写入每秒<br>
  每秒中用户产生的feed有500条左右，这500条需要发给特定的一群人，平均分给一百人，每秒大概5W</p>
  
  <p>SearchCache  全站用户数据全缓存服务 长青<br>
  以struct形式存储用户，一个亿的用户会占65.2G内存，不包括内存碎片等实际开销。<br>
  去掉struct的内存结构化开销，通过序列化反序列化来压缩内存占用。<br>
  内存优化比例大概在40－70％之间。</p>
  
  <p>锁的效率 军辉<br>
  原子作效率最好<br>
  自旋锁的效率还不错<br>
  hash函数：boobs（memcache里的） 性能和均匀程度最好的是murmur stdhash是最不好的<br>
  其他经验：<br>
  一个锁有严重的效率问题<br>
  锁的数目在并发线程数的10部时最好<br>
  pthread spinlock有效率问题 争用发生时延迟达5－10ms<br>
  spinlock的cpu消耗比mutex低<br>
  实现lockfree需要抛弃一些特性</p>
  
  <p>专家说明：spinlock使用时可能会cpu特高，用的时候小心。</p>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2009/12/24/ubuntu-910-quick-install-nginx-php-notes-from-the-environment-54/">Ubuntu 9.10快速安装nginx+php环境手记[54chen科学院]</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2009-12-24T00:00:00+08:00" pubdate data-updated="true">2009-12-24 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p>我(<a href="http://www.54chen.com">54chen</a>)因为场景需要，特地在<a href="http://www.54chen.com/_linux_/11-return-ubuntu-910-notes-from-the-hard-disk-installation.html">ubuntu9.10</a>中安装nginx+php的环境，要快速不要优化，记录如下：
  </p>
<blockquote>sudo apt-get install php5 php5-cgi php5-cli php5-gd php5-curl php5-mysql nginx</blockquote>
  
  <p>sudo apt-get install lighttpd</p>
  
  <p>spawn-fcgi -a 127.0.0.1 -p 9000 -C 5 -u www-data -g www-data -f /usr/bin/php-cgi
  上面的作解读：</p>
  
  <p>1.安装php nginx</p>
  
  <p>2.安装lighttpd，为啥要安装这个，因为他有个spawn-fcgi，因为apt下来的php不是php-fpm。</p>
  
  <p>3.用spawn-fcgi启动php-cgi在9000端口监听。
  </p>
<blockquote>sudo vim /etc/php5/cgi/php.ini</blockquote>
  
  <p>修改php.ini文件</p>
  
  <p>cgi.fix_pathinfo=1; 这样php-cgi方能正常使用SCRIPT_FILENAME这个变量
  sudo vim /etc/nginx/sites-enabled/www.54chen.com
  </p>
<blockquote>server {<br>
  listen 80; //端口<br>
  server_name wiki.54chen.com; //虚拟域名<br>
  access_log /var/log/nginx/hwiki.54chen.com.access.log; //访问日志<br>
  location / {<br>
  root /home/wiki.54chen.com; //size根目录<br>
  index index.php;<br>
  }
  location ~ \.php$ { #php fastcgi的配置<br>
  fastcgi_pass 127.0.0.1:9000; #php fastcgi的代理端口与ip<br>
  fastcgi_index index.php;<br>
  fastcgi_param SCRIPT_FILENAME /home/wiki.54chen.com$fastcgi_script_name; #要处理的php文件的路径<br>
  include /etc/nginx/fastcgi_params; #fastcgi的参数文件地址<br>
  }
  }</blockquote>
  好，上面的作就建立了一个<a href="http://www.54chen.com/memo/%e4%b8%80%e5%8f%a5%e8%af%9d%e8%ae%b0%e5%bd%95%e5%a4%87%e5%bf%98.html">虚拟主机</a>，保存好。
  
  <p>sudo killall apache2</p>
  
  <p>杀掉apache，启动nginx.</p>
  
  <p>sudo /etc/init.d/nginx start</p>
  
  <p>大功告成！整个过程不超过十五分钟。呼呼～～</p>
  
  <p>圣诞快乐！！！</p>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2009/12/21/arrow-network-cmax-ria-china-technology-summit-returned-to-share-draft-speech/">艾睿网 CMAX（RIA）技术峰会归来 演稿分享</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2009-12-21T00:00:00+08:00" pubdate data-updated="true">2009-12-21 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p>感谢junidea、kenshin等牛人的组织和邀请，为这次技术峰会的成功举办感到由衷的高兴，这一群新兴的群体，在一线的朋友们，到场的牛人还有《Flex 3 RIA开发详解与精深实践》作者杨占坡、杨铭、《银光开发者工作室》的魏永超、还有出版社和媒体的各位朋友，大家都为各自领域的见解进行了深刻的探讨，在会上我作了《HTTP：RIA REST CLOUD》的分享，同时借此结交了不少各行业兴趣相投的好朋友。</p>
  
  <p>以下是活动海报，还有上海和广州的会场，那边关心RIA的朋友可以关注一下时间：</p>
  
  <p><a href="http://www.airia.cn/cmax2009/welcome.html">http://www.airia.cn/cmax2009/welcome.html</a></p>
  
  <p>我分享的主题的演示稿在下面（请使用firefox打开）：</p>
  
  <p><a href="http://www.54chen.com/ria/200912.xul%20">http://www.54chen.com/ria/200912.xul</a></p>
  
  <p>稍候应该还有图片和视频资料送出。</p>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2009/12/16/all-net-jobs-java-as-c-engineer-special-for-the-academy-of-sciences-valid-for-two-months/">人人网招聘JAVA、AS、C++工程师（科学院特供，两月内有效）</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2009-12-16T00:00:00+08:00" pubdate data-updated="true">2009-12-16 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p>科学院年底发布人人网职位推荐消息：</p>
  
  <p><strong>人人网Flash (AS3)程序员</strong>
  1.计算机、软件类相关专业本科以上学历<br>
  2.AS2\Flex\AS3一年以上开发经验
  <strong>人人网JAVA架构师</strong>
  1.计算机及相关专业本科以上学历<br>
  2.三年以上Java开发经验
  <strong>人人网产品经理</strong>
  1.本科以上学历<br>
  2.两年以上互联网工作经验
  <strong>游戏制作人（游戏中心）
  </strong>1.本科以上学历<br>
  2.两年以上主策划工作经验<br>
  3.两个以上完整上线项目经验者优先</p>
  
  <p><strong>C++工程师（分win下和linux下的）</strong></p>
  
  <p>1.win：C++基础扎实，有客户端界面和控件开发经验</p>
  
  <p>2.linux：两年以上开发经验</p>
  
  <p>以上为科学院精简人力废话版本招聘条件，如果任何一条不满足请不要把简历投到<a href="mailto:cc0cc@126.com">cc0cc@126.com</a>，也不要纯洁地问工资情况，人力告诉你的要准确得多，另这些都是中高级职位，有意者牛X者尽管过来，有酒肉。</p>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2009/12/14/php-java-c-upload-files-how-to-accurately-determine-the-file-type-mime-literacy/">PHP JAVA C上传文件如何准确判断文件类型－mime知识普及</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2009-12-14T00:00:00+08:00" pubdate data-updated="true">2009-12-14 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p>MIME的英文全称是"Multipurpose Internet Mail Extensions" 多功能Internet 邮件扩充服务，它是一种多用途网际邮件扩充协议，在1992年最早应用于电子邮件系统，但后来也应用到浏览器。服务器会将它们发送的多媒体数据的类型告诉 浏览器，而通知手段就是说明该多媒体数据的<a href="http://www.54chen.com/61-php%e2%80%9c%e6%94%b6%e5%8f%91%e2%80%9d%e9%82%ae%e4%bb%b6%e7%9a%84%e4%b8%80%e4%b8%aa%e7%a8%8b%e5%ba%8f/">MIME</a>类型，从而让浏览器知道接收到的信息哪些是MP3文件，哪些是Shockwave文件等等。服务器将 <a href="http://www.54chen.com/61-php%e2%80%9c%e6%94%b6%e5%8f%91%e2%80%9d%e9%82%ae%e4%bb%b6%e7%9a%84%e4%b8%80%e4%b8%aa%e7%a8%8b%e5%ba%8f/">MIME</a>标志符放入传送的数据中来告诉浏览器使用哪种插件读取相关文件。
  </p>
<table style="width: 534px; height: 110px;" border="1" cellspacing="0">
  <tbody>
  <tr>
  <td>文件</td>
  <td>用IE7上传</td>
  <td>用Firefox3.0上传</td>
  </tr>
  <tr>
  <td>GIF</td>
  <td>
  <p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: '*';"><span style="font-family: Times New Roman;">image/gif</span> </span></p>
  </td>
  <td>
  <p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: '*';"><span style="font-family: Times New Roman;">image/gif</span> </span></p>
  </td>
  </tr>
  <tr>
  <td>JPG</td>
  <td>
  <p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: '*';"><span style="font-family: Times New Roman;"><span style="color: #ff0000;">image/pjpeg</span> </span></span></p>
  </td>
  <td>
  <p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: '*';"><span style="font-family: Times New Roman;">image/jpeg</span> </span></p>
  </td>
  </tr>
  <tr>
  <td>ZIP</td>
  <td><span style="color: #ff0000;">application/x-compressed</span></td>
  <td><span style="font-family: '*';"><span style="color: #ff0000; font-family: Times New Roman;">application/octet-stream</span> </span></td>
  </tr>
  <tr>
  <td>JSP</td>
  <td>
  <p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: '*';"><span style="font-family: Times New Roman;">text/html</span> </span></p>
  </td>
  <td>
  <p class="MsoNormal" style="margin: 0cm 0cm 0pt;"><span style="font-family: '*';"><span style="font-family: Times New Roman;">text/html</span> </span></p>
  </td>
  </tr>
  <tr>
  <td>EXE</td>
  <td><span style="font-family: '*';"><span style="font-family: Times New Roman;">application/octet-stream</span> </span></td>
  <td><span style="font-family: '*';"><span style="font-family: Times New Roman;">application/octet-stream</span> </span></td>
  </tr>
  </tbody>
</table>
  上边的图哦不红图表示出了不同的浏览器所上传的不同的<a href="http://www.54chen.com/61-php%e2%80%9c%e6%94%b6%e5%8f%91%e2%80%9d%e9%82%ae%e4%bb%b6%e7%9a%84%e4%b8%80%e4%b8%aa%e7%a8%8b%e5%ba%8f/">mime</a>的区别，研究了一下，暂时没有发现可修改假冒mime的方法。
  <p style="margin: 5px; line-height: 150%;"><code><span style="color: #000000;"><span style="font-family: NSimsun;"><span style="color: #0000cc;">&lt;</span><span style="color: #0000ff;">form</span> <strong><span style="color: #ff0000;">enctype</span><span style="color: #0000cc;">=</span><span style="color: #ff00ff;">"multipart/form-data"</span></strong> <span style="color: #ff0000;">action</span><span style="color: #0000cc;">=</span><span style="color: #ff00ff;">"URL"</span> <span style="color: #ff0000;">method</span><span style="color: #0000cc;">=</span><span style="color: #ff00ff;">"post"</span><span style="color: #0000cc;">&gt;</span>
  <span style="color: #0000cc;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #ff0000;">type</span><span style="color: #0000cc;">=</span><span style="color: #ff00ff;">"hidden"</span> <span style="color: #ff0000;">name</span><span style="color: #0000cc;">=</span><span style="color: #ff00ff;">"MAX_FILE_SIZE"</span> <span style="color: #ff0000;">value</span><span style="color: #0000cc;">=</span><span style="color: #ff00ff;">"1000"</span><span style="color: #0000cc;">&gt;</span>
  <span style="color: #0000cc;">&lt;</span><span style="color: #0000ff;">input</span> <strong><span style="color: #ff0000;">name</span><span style="color: #0000cc;">=</span><span style="color: #ff00ff;">"myFile"</span></strong> <span style="color: #ff0000;">type</span><span style="color: #0000cc;">=</span><span style="color: #ff00ff;">"file"</span><span style="color: #0000cc;">&gt;</span>
  <span style="color: #0000cc;">&lt;</span><span style="color: #0000ff;">input</span> <span style="color: #ff0000;">type</span><span style="color: #0000cc;">=</span><span style="color: #ff00ff;">"submit"</span> <span style="color: #ff0000;">value</span><span style="color: #0000cc;">=</span><span style="color: #ff00ff;">"上传文件"</span><span style="color: #0000cc;">&gt;</span>
  <span style="color: #0000cc;">&lt;</span><span style="color: #0000cc;">/</span><span style="color: #0000ff;">form</span><span style="color: #0000cc;">&gt;</span></span></span></code></p>
  
  <p></p>
<p style="margin: 5px; line-height: 150%;">
  </p>
<p style="margin: 5px; line-height: 150%;">这个代码上传文件后：</p>
  <p style="margin: 5px; line-height: 150%;">使用PHP:</p>
  <p style="margin: 5px; line-height: 150%;">$_FILES['myFile']['<strong>type</strong>']   文件的 MIME 类型，需要浏览器提供该信息的支持，例如"<a href="http://www.54chen.com/576-54%e9%99%88%e7%a7%91%e5%ad%a6%e9%99%a28021x%e6%ba%90%e4%bb%a3%e7%a0%81%e4%b8%8b%e8%bd%bd/">image</a>/gif"。</p>
  
  <p></p>
<p style="margin: 5px; line-height: 150%;">
  </p>
<p style="margin: 5px; line-height: 150%;">使用struts2限制类型：</p>
  
  <p></p>
<p style="margin: 5px; line-height: 150%;">&lt;interceptor-ref name="fileUpload"&gt;<br>
  &lt;param name="allowedTypes"&gt;application/zip,application/x-zip-compressed,application/rar,application/octet-stream&lt;/param&gt;<br>
  &lt;param name="maximumSize"&gt;3145728&lt;/param&gt;<br>
  &lt;/interceptor-ref&gt;</p>
  
  <p></p>
<p style="margin: 5px; line-height: 150%;">
  </p>
<p style="margin: 5px; line-height: 150%;">使用C/java（由<a href="http://www.54chen.com/801-54-chen-academy-schools-the-development-process-and-the-album-broke-the-heart-of-technical-analysis/">人人网</a>文斌大侠提供）：</p>
  
  <p></p>
<div class="Section1" style="layout-grid: 15.6pt none;">
  <p class="MsoNormal" style="text-align: left;" align="left"><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">public</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">static</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">boolean</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> isImageJpeg(</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">[] blob) {</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">if</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> (blob != </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">null</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &amp;&amp; blob.</span></span><span style="font-size: x-small; color: #0000c0; font-family: Courier New;"><span style="font-size: 10pt; color: #0000c0; font-family: 'Courier New';" lang="EN-US">length</span></span><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &gt; 2) {</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><span style="font-size: x-small; color: #3f7f5f; font-family: Courier New;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 'Courier New';" lang="EN-US">// 0xFFD8</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">if</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> (blob[0] == (</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)0xFF &amp;&amp; </span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              blob[1] == (</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)0xD8) {</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">return</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">true</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           }</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       }</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">return</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">false</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">    }</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">    </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">public</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">static</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">boolean</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> isImageBmp(</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">[] blob) {</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">if</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> (blob != </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">null</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &amp;&amp; blob.</span></span><span style="font-size: x-small; color: #0000c0; font-family: Courier New;"><span style="font-size: 10pt; color: #0000c0; font-family: 'Courier New';" lang="EN-US">length</span></span><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &gt; 2) {</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><span style="font-size: x-small; color: #3f7f5f; font-family: Courier New;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 'Courier New';" lang="EN-US">// BM: Windows 3.1x, 95, NT, … </span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><span style="font-size: x-small; color: #3f7f5f; font-family: Courier New;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 'Courier New';" lang="EN-US">// BA: OS/2 Bitmap Array</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><span style="font-size: x-small; color: #3f7f5f; font-family: Courier New;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 'Courier New';" lang="EN-US">// CI: OS/2 Color Icon</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><span style="font-size: x-small; color: #3f7f5f; font-family: Courier New;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 'Courier New';" lang="EN-US">// CP: OS/2 Color Pointer</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><span style="font-size: x-small; color: #3f7f5f; font-family: Courier New;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 'Courier New';" lang="EN-US">// IC: OS/2 Icon</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><span style="font-size: x-small; color: #3f7f5f; font-family: Courier New;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 'Courier New';" lang="EN-US">// PT: OS/2 Pointer</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">if</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> ((blob[0] == </span></span><span style="font-size: x-small; color: #2a00ff; font-family: Courier New;"><span style="font-size: 10pt; color: #2a00ff; font-family: 'Courier New';" lang="EN-US">'B'</span></span><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &amp;&amp; </span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">               blob[1] == </span></span><span style="font-size: x-small; color: #2a00ff; font-family: Courier New;"><span style="font-size: 10pt; color: #2a00ff; font-family: 'Courier New';" lang="EN-US">'M'</span></span><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">               ||</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              (blob[0] == </span></span><span style="font-size: x-small; color: #2a00ff; font-family: Courier New;"><span style="font-size: 10pt; color: #2a00ff; font-family: 'Courier New';" lang="EN-US">'B'</span></span><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &amp;&amp;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">               blob[1] == </span></span><span style="font-size: x-small; color: #2a00ff; font-family: Courier New;"><span style="font-size: 10pt; color: #2a00ff; font-family: 'Courier New';" lang="EN-US">'A'</span></span><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)) {</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">return</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">true</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           }</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       }</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">return</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">false</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">    }</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">    </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">public</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">static</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">boolean</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> isImagePng(</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">[] blob) {</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">if</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> (blob != </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">null</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &amp;&amp; blob.</span></span><span style="font-size: x-small; color: #0000c0; font-family: Courier New;"><span style="font-size: 10pt; color: #0000c0; font-family: 'Courier New';" lang="EN-US">length</span></span><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &gt; 8) {</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><span style="font-size: x-small; color: #3f7f5f; font-family: Courier New;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 'Courier New';" lang="EN-US">// 89 50 4E 47 0D 0A 1A 0A</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">if</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> (blob[0] == (</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)0x89 &amp;&amp;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              blob[1] == (</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)0x50 &amp;&amp;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              blob[2] == (</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)0x4E &amp;&amp;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              blob[3] == (</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)0x47    &amp;&amp;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              blob[4] == (</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)0x0D &amp;&amp;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              blob[5] == (</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)0x0A &amp;&amp;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              blob[6] == (</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)0x1A &amp;&amp;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              blob[7] == (</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)0x0A)</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">return</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">true</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       }</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">return</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">false</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">    }</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">    </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">public</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">static</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">boolean</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> isImageGif(</span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">byte</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">[] blob) {</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">if</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> (blob != </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">null</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &amp;&amp; blob.</span></span><span style="font-size: x-small; color: #0000c0; font-family: Courier New;"><span style="font-size: 10pt; color: #0000c0; font-family: 'Courier New';" lang="EN-US">length</span></span><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &gt; 3) { </span></span><span style="font-size: x-small; color: #3f7f5f; font-family: Courier New;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 'Courier New';" lang="EN-US">// </span></span><span style="font-size: x-small; color: #3f7f5f; font-family: 宋体;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 宋体;">只有</span></span><span style="font-size: x-small; color: #3f7f5f; font-family: Courier New;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 'Courier New';" lang="EN-US">3</span></span><span style="font-size: x-small; color: #3f7f5f; font-family: 宋体;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 宋体;">字节的</span></span><span style="font-size: x-small; color: #3f7f5f; font-family: Courier New;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 'Courier New';" lang="EN-US">gif</span></span><span style="font-size: x-small; color: #3f7f5f; font-family: 宋体;"><span style="font-size: 10pt; color: #3f7f5f; font-family: 宋体;">？这里仅避免异常</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">           </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">if</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> (blob[0] == </span></span><span style="font-size: x-small; color: #2a00ff; font-family: Courier New;"><span style="font-size: 10pt; color: #2a00ff; font-family: 'Courier New';" lang="EN-US">'G'</span></span><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &amp;&amp;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              blob[1] == </span></span><span style="font-size: x-small; color: #2a00ff; font-family: Courier New;"><span style="font-size: 10pt; color: #2a00ff; font-family: 'Courier New';" lang="EN-US">'I'</span></span><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> &amp;&amp;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              blob[2] == </span></span><span style="font-size: x-small; color: #2a00ff; font-family: Courier New;"><span style="font-size: 10pt; color: #2a00ff; font-family: 'Courier New';" lang="EN-US">'F'</span></span><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">)</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">              </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">return</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">true</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       }</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal" style="text-align: left;" align="left"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">       </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">return</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US"> </span></span><strong><span style="font-size: x-small; color: #7f0055; font-family: Courier New;"><span style="font-weight: bold; font-size: 10pt; color: #7f0055; font-family: 'Courier New';" lang="EN-US">false</span></span></strong><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">;</span></span><span style="font-size: x-small; font-family: Courier New;"><span style="font-size: 10pt; font-family: 'Courier New';" lang="EN-US"></span></span></p>
  <p class="MsoNormal"><span style="font-size: x-small; color: #000000; font-family: Courier New;"><span style="font-size: 10pt; color: black; font-family: 'Courier New';" lang="EN-US">    }</span></span><span style="font-size: xx-small; font-family: Arial;"><span style="font-size: 9pt; font-family: Arial;" lang="EN-US"></span></span></p>
</div>
  
  <p></p>
  </div>
    
    
  
  
      </article>
    
    
      <article>
        
    <header>
      
        <h1 class="entry-title"><a href="/blog/2009/12/08/java-list-transferred-byte-method/">Java List转byte[]的方法</a></h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2009-12-08T00:00:00+08:00" pubdate data-updated="true">2009-12-08 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
    <div class="entry-content entry-content1">
<p>先做一个试验：
  </p>
<blockquote>Test.java</blockquote>
  
  <p>package test;<br>
  import java.util.ArrayList;<br>
  import java.util.List;<br>
  public class Test {<br>
  public static void main(String[] args) {<br>
  List&lt;Integer&gt; lst = new ArrayList&lt;Integer&gt;();<br>
  for (int i = 0; i &lt; 100; i++) {<br>
  lst.add(i);<br>
  }
  System.out.print(lst.toString());<br>
  }
  }
  得到结果：列出了所有的数字
  </p>
<blockquote>[0, 1, 2, 3, 4, 5, 6。。。</blockquote>
  进一步进行改进：
  <blockquote>package test;</blockquote>
  
  <p>import java.util.ArrayList;<br>
  import java.util.List;</p>
  
  <p>public class Test {<br>
  public static void main(String[] args) {<br>
  List&lt;BlockData&gt; lst = new ArrayList&lt;BlockData&gt;();<br>
  for (int i = 0; i &lt; 100; i++) {</p>
  
  <p>lst.add(new BlockData(i,i));<br>
  }
  System.out.print(lst.toString());<br>
  }
  /**<br>
  * 定义一个乱七八糟的class<br>
  * @author cc<br>
  *
  */<br>
  public static class BlockData {<br>
  public int version;<br>
  public int count;<br>
  public List&lt;String&gt; list;</p>
  
  <p>public BlockData(int version, int count) {<br>
  this.version = version;<br>
  this.count = count;<br>
  this.list = new ArrayList&lt;String&gt;(count);<br>
  }</p>
  
  <p>public BlockData(int version, int count, List&lt;String&gt; list) {<br>
  this.version = version;<br>
  this.count = count;<br>
  this.list = list;<br>
  }
  }<br>
  }
  运行后的结果：
  </p>
<blockquote>[test.Test$BlockData@1bc4459, test.Test$BlockData@12b6651, ...</blockquote>
  从后面一个例子看到的object在<a href="http://www.54chen.com/705-peer-to-peer-distributed-hash-algorithm-in-the-mainstream-of-comparative-analysis-of-the-collection/">toString</a>的时候，对象只是一个串了，要想再恢复成<a href="http://www.54chen.com/814-tokyo-cabinet-with-java-concurrent-test-the-performance-of-a-major-correction-articles/">object</a>不可能了。54chen曾想把list.toString.getBytes，被证明是不靠谱的做法。
  
  <p>而要想把一个list变成byte[]在网络上传输，看下面的代码：
  </p>
<blockquote>public void encode(OutputStream os) throws IOException {<br>
  List&lt;NuclearStorageValue&gt; list = data.list;</blockquote>
  
  <p>if (list != null &amp;&amp; list.size() &gt; 0) {</p>
  
  <p>for (NuclearStorageValue value : list) {<br>
  // 依次写入每条数据的长度和数据内容<br>
  byte[] bytes = value.toByteArray();</p>
  
  <p>os.write(int2bytes(bytes.length));<br>
  os.write(bytes);<br>
  }
  }<br>
  }</p>
  
  <p>public byte[] int2bytes(int val) {<br>
  byte[] b = new byte[4];<br>
  b[0] = (byte) (val &gt;&gt; 24);<br>
  b[1] = (byte) ((val &lt;&lt; 8) &gt;&gt; 24);<br>
  b[2] = (byte) ((val &lt;&lt; 16) &gt;&gt; 24);<br>
  b[3] = (byte) ((val &lt;&lt; 24) &gt;&gt; 24);<br>
  return b;<br>
  }</p>
  </div>
    
    
  
  
      </article>
    
    
      <div class="pagination">
    
      <a href="/posts/38">« Prev</a>
    
  
    
      
        <a href="/">1</a>
      
    
      
        <a href="/posts/2">2</a>
      
    
      
        <a href="/posts/3">3</a>
      
    
      
        <a href="/posts/4">4</a>
      
    
      
        <a href="/posts/5">5</a>
      
    
      
        <a href="/posts/6">6</a>
      
    
      
        <a href="/posts/7">7</a>
      
    
      
        <a href="/posts/8">8</a>
      
    
      
        <a href="/posts/9">9</a>
      
    
      
        <a href="/posts/10">10</a>
      
    
      
        <a href="/posts/11">11</a>
      
    
      
        <a href="/posts/12">12</a>
      
    
      
        <a href="/posts/13">13</a>
      
    
      
        <a href="/posts/14">14</a>
      
    
      
        <a href="/posts/15">15</a>
      
    
      
        <a href="/posts/16">16</a>
      
    
      
        <a href="/posts/17">17</a>
      
    
      
        <a href="/posts/18">18</a>
      
    
      
        <a href="/posts/19">19</a>
      
    
      
        <a href="/posts/20">20</a>
      
    
      
        <a href="/posts/21">21</a>
      
    
      
        <a href="/posts/22">22</a>
      
    
      
        <a href="/posts/23">23</a>
      
    
      
        <a href="/posts/24">24</a>
      
    
      
        <a href="/posts/25">25</a>
      
    
      
        <a href="/posts/26">26</a>
      
    
      
        <a href="/posts/27">27</a>
      
    
      
        <a href="/posts/28">28</a>
      
    
      
        <a href="/posts/29">29</a>
      
    
      
        <a href="/posts/30">30</a>
      
    
      
        <a href="/posts/31">31</a>
      
    
      
        <a href="/posts/32">32</a>
      
    
      
        <a href="/posts/33">33</a>
      
    
      
        <a href="/posts/34">34</a>
      
    
      
        <a href="/posts/35">35</a>
      
    
      
        <a href="/posts/36">36</a>
      
    
      
        <a href="/posts/37">37</a>
      
    
      
        <a href="/posts/38">38</a>
      
    
      
        <em>39</em>
      
    
      
        <a href="/posts/40">40</a>
      
    
      
        <a href="/posts/41">41</a>
      
    
      
        <a href="/posts/42">42</a>
      
    
      
        <a href="/posts/43">43</a>
      
    
      
        <a href="/posts/44">44</a>
      
    
      
        <a href="/posts/45">45</a>
      
    
      
        <a href="/posts/46">46</a>
      
    
      
        <a href="/posts/47">47</a>
      
    
      
        <a href="/posts/48">48</a>
      
    
      
        <a href="/posts/49">49</a>
      
    
      
        <a href="/posts/50">50</a>
      
    
      
        <a href="/posts/51">51</a>
      
    
      
        <a href="/posts/52">52</a>
      
    
      
        <a href="/posts/53">53</a>
      
    
      
        <a href="/posts/54">54</a>
      
    
      
        <a href="/posts/55">55</a>
      
    
      
        <a href="/posts/56">56</a>
      
    
  
    
      <a href="/posts/40">Next »</a>
    
  </div>
  
  
    <div class="pagination">
      <a href="/blog/archives">Blog Archives</a>
    </div>
  </div>
  <aside class="sidebar">
    
      
    
  </aside>
  
    </div>
    <footer role="contentinfo" class="footer_css">  <script src="/javascripts/modernizr-2.0.js"></script>
    <script src="/javascripts/libs/jquery.min.js"></script>
    <script src="/javascripts/octopress.js" type="text/javascript"></script>
    Copyright © 2017 - 54chen -
  
  </footer>
    
  
  
  
  
  
  
  
  
  
  </div>
</body>
  </html>
