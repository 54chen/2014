<html class="no-js" lang="en">
<!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>一场技术的圣战：rose开源框架之portal - 五四陈科学院</title>
    <meta name="author" content="54chen">
  
    
    <meta name="description" content="作者：人人网架构师 王志亮 （54chen按：此文为客座博文，王志亮大侠，人人网架构师，疱丁分词创始人，rose是他的另一开源大作。关于69圣战，请看http://zhidao.baidu.com/question/158643718.html?si=2&amp;wtp=wk） …">
    
  
    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  
    
    <link rel="canonical" href="https://www.54chen.com/blog/2010/06/10/rose-open-source-portal-framework">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/fkwb.css?v6" type="text/css" rel="stylesheet">  
    <link href="/atom.xml" rel="alternate" title="五四陈科学院" type="application/atom+xml">
    	<link rel="apple-touch-icon" href="touch-icon.png">
  	<link rel="shortcut icon" href="/favicon.ico">
  
    
  
    <style type="text/css">.entry-content table {display: block;width: 100%;overflow: auto;word-break: normal;word-break: keep-all;}.entry-content table th {font-weight: bold;}.entry-content table th,.entry-content table td {padding: 6px 13px;border: 1px solid #ddd;}.entry-content table tr {background-color: #fff;border-top: 1px solid #ccc;}.entry-content table tr:nth-child(2n) {background-color: #f8f8f8;}</style>
  </head>
  
  <body>
    <header role="banner" class="banner_css"><a style="float:left" href="/"><img border="0" src="/images/54chen-logo.gif" alt="五四陈科学院-相信科学，分享技术." title="五四陈科学院-相信科学，分享技术.">
  </a>
  <div>
      <a href="/">首页</a>
      <a href="/blog/archives">归档</a>
      <a href="/video">视频</a>
      <a href="/about">关于</a>
  
      <a href="http://www.54chen.com" style="font-size:9px">想找旧版内容？</a>
  </div>
  <div class="subscription">
    
  <form action="https://www.54chen.com/cgi" method="get">
    <fieldset role="search">
      
      <input class="search" type="text" name="key" placeholder="Search">
    </fieldset>
  </form>
    
  
  </div>
  
  </header>
    <nav role="navigation"><ul class="subscription" data-subscription="rss">
    <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
    
  </ul>
    
  <form action="https://www.54chen.com/cgi" method="get">
    <fieldset role="search">
      
      <input class="search" type="text" name="key" placeholder="Search">
    </fieldset>
  </form>
    
    <li><a href="/">Blog</a></li>
    <li><a href="/blog/archives">Archives</a></li>
  
  </nav>
    <div id="main">
      <div id="content">
        <div>
  <article class="hentry" role="article">
    
    <header>
      
        <h1 class="entry-title">一场技术的圣战：rose开源框架之portal</h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2010-06-10T00:00:00+08:00" pubdate data-updated="true">2010-06-10 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
  <div class="entry-content">
<p></p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;">作者：人人网架构师 王志亮</p>
  
  <p></p>
<blockquote>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><strong>（54chen按：此文为客座博文，王志亮大侠，人人网架构师，疱丁分词创始人，rose是他的另一开源大作。关于69圣战，请看<a href="http://zhidao.baidu.com/question/158643718.html?si=2&amp;wtp=wk">http://zhidao.baidu.com/question/158643718.html?si=2&amp;wtp=wk</a>）</strong></p>
  </blockquote>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;">
  </p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">2010</span><span style="padding: 0px; margin: 0px;">年的</span><span style="padding: 0px; margin: 0px;">6</span><span style="padding: 0px; margin: 0px;">月</span><span style="padding: 0px; margin: 0px;">9</span><span style="padding: 0px; margin: 0px;">日是一个圣战的日子，零点一到就有人开始，好戏也如约在晚上7点发生。人人网战场是</span><span style="padding: 0px; margin: 0px;">SJ</span><span style="padding: 0px; margin: 0px;">的公共主页：</span><span style="padding: 0px; margin: 0px;"><a style="color: #005eac; cursor: pointer; text-decoration: none; padding: 0px; margin: 0px;" href="http://page.renren.com/sj">http://page.renren.com/sj</a></span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"> </p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">对不同人，这个日子意味着不同，滋味也不同。作为人人网技术团队，我们要保证服务能力、用户体验能够应付得了这个挑战。</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"> </p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">某一个服务器的能力总有限，为了应付突然增长的读写量，</span><span style="padding: 0px; margin: 0px;">web</span><span style="padding: 0px; margin: 0px;">服务架构、内部服务架构、数据库架构等要能够轻松通过服务器调配来满足。就</span><span style="padding: 0px; margin: 0px;">web</span><span style="padding: 0px; margin: 0px;">服务器而言，我们增加了</span><span style="padding: 0px; margin: 0px;">1</span><span style="padding: 0px; margin: 0px;">倍的机器。现在再回头来看监控的数据，一切显得美好。这个期间整个服务做到了服务能力没有中断。除此之外，在这次圣战中，其中还有一项我们<strong>独有的</strong>技术起到了重要的作用：</span><span style="padding: 0px; margin: 0px;"><a style="color: #005eac; cursor: pointer; text-decoration: none; padding: 0px; margin: 0px;" href="http://code..com/p/paoding-rose/">rose portal</a> </span><span style="padding: 0px; margin: 0px;">，下面作一个介绍：</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"> </p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">图1是</span><span style="padding: 0px; margin: 0px;">sj</span><span style="padding: 0px; margin: 0px;">的主页：</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"> </p>
  
  <p><img style="max-width: 550px; padding: 0px; margin: 0px;" src="http://img05.taobaocdn.com/bao/uploaded/i5/T1RDFCXcdeXXcmuYvb_123212.jpg" alt="" width="558" height="418"></p>
  
  <p>图1 sj在人人网的公共主页
  </p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">这个页面分为三列：</span></p>
  
  <p></p>
<ul style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 30px; list-style-type: disc; list-style-position: outside; list-style-image: initial; margin: 0px;">
  	<li style="padding: 0px; margin: 0px;">
<span style="padding: 0px; margin: 0px;">左边有</span> <span style="padding: 0px; margin: 0px;">“推荐给好友”、“基本信息”、“相册”</span><span style="padding: 0px; margin: 0px;">;</span>
</li>
  	<li style="padding: 0px; margin: 0px;">
<span style="padding: 0px; margin: 0px;">中间有“给</span><span style="padding: 0px; margin: 0px;">SJ</span><span style="padding: 0px; margin: 0px;">留言”、“好友留言”</span><span style="padding: 0px; margin: 0px;">;</span>
</li>
  	<li style="padding: 0px; margin: 0px;">右边有“好友”，“人人的用户还关注”等。</li>
  </ul>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;">
  </p>
<p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">在后台，这些被分解为不同的模块，我们称之为</span><span style="padding: 0px; margin: 0px;">”window”</span><span style="padding: 0px; margin: 0px;">。这每一个</span><span style="padding: 0px; margin: 0px;">window</span><span style="padding: 0px; margin: 0px;">都意味着可能连接一个的服务集群，比如基本信息服务、留言服务、好友服务、相册服务等等。这样，一个公共主页就等于多个的、可配置的</span><span style="padding: 0px; margin: 0px;">window</span><span style="padding: 0px; margin: 0px;">模块组成，如图2所示 ：</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><img style="max-width: 550px; padding: 0px; margin: 0px;" src="http://img07.taobaocdn.com/bao/uploaded/i7/T1M_hCXiplXXXZgsbb_123302.jpg" alt="" width="557" height="417"></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;">图2 公共主页的<span style="padding: 0px; margin: 0px;">window</span><span style="padding: 0px; margin: 0px;">模块组成</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">随着伟大圣战的深入，这个页面就变成这样</span><span style="padding: 0px; margin: 0px;">(</span><span style="padding: 0px; margin: 0px;">右边的栏目不见了</span><span style="padding: 0px; margin: 0px;">)，如图3所示</span><span style="padding: 0px; margin: 0px;">：</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><img style="max-width: 550px; padding: 0px; margin: 0px;" src="http://img06.taobaocdn.com/bao/uploaded/i6/T1WmpCXntyXXcpbsDb_123341.jpg" alt="" width="353" height="250"></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;">图3 圣战进行中时模块的自动保护</p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">产品同学看到此情此景，仍然很开心：“只要留言的</span><span style="padding: 0px; margin: 0px;">window</span><span style="padding: 0px; margin: 0px;">能在，其它的没在不要紧”</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">但是不一会，继续恶化，如图4所示：</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><img style="max-width: 550px; padding: 0px; margin: 0px;" src="http://img06.taobaocdn.com/bao/uploaded/i6/T1qCJCXaRuXXXtnc6b_123408.jpg" alt="" width="310" height="247"></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;">图4 圣战进行中压力进一步增加</p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">甚至到了图5的情形：</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"> </p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><img style="max-width: 550px; padding: 0px; margin: 0px;" src="http://img08.taobaocdn.com/bao/uploaded/i8/T1WnpCXdBjXXa5e0nb_123436.jpg" alt="" width="321" height="237"></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;">图5 圣战进行中压力进一步增加</p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><a style="color: #005eac; cursor: pointer; text-decoration: none; padding: 0px; margin: 0px;" href="http://topaz.renren.com/" target="_blank">晶</a><span style="padding: 0px; margin: 0px;">看着公共主页呈现出这种状况时，笑着形容这样的图“缺胳膊少腿”：“怎么还没加机器”。当公共主页技术团队把机器逐步增加一倍的时候，这种情况变少了，甚至就没有了。</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">虽然这些页面看起来“缺胳膊少腿”，<strong>但要知道在以前，这种情况，我们整个页面的某个模块堵了可会导致用户浏览器长期空白，直至最后提示网页不可显示。这给用户带来很不好的体验，同时因为网页一直不释放连接，恶性循环导致</strong></span><strong><span style="padding: 0px; margin: 0px;">web</span></strong><strong><span style="padding: 0px; margin: 0px;">服务器最后全哑了。</span></strong></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">好在，早在半年前我们开发了</span><span style="padding: 0px; margin: 0px;">rose portal</span><span style="padding: 0px; margin: 0px;">框架，解决了此问题，</span><span style="padding: 0px; margin: 0px;">rose portal</span><span style="padding: 0px; margin: 0px;">是一个<strong>服务端</strong></span><strong><span style="padding: 0px; margin: 0px;">portal</span></strong><span style="padding: 0px; margin: 0px;">技术，基于</span><span style="padding: 0px; margin: 0px;">rose</span><span style="padding: 0px; margin: 0px;">框架</span> <span style="padding: 0px; margin: 0px;">(</span><span style="padding: 0px; margin: 0px;">也就是</span><span style="padding: 0px; margin: 0px;">servlet</span><span style="padding: 0px; margin: 0px;">容器</span><span style="padding: 0px; margin: 0px;">) </span><span style="padding: 0px; margin: 0px;">下的服务端</span><span style="padding: 0px; margin: 0px;">portal</span><span style="padding: 0px; margin: 0px;">技术，</span><span style="padding: 0px; margin: 0px;">rose portal</span><span style="padding: 0px; margin: 0px;">不是</span><span style="padding: 0px; margin: 0px;">Java</span><span style="padding: 0px; margin: 0px;">常说的</span><span style="padding: 0px; margin: 0px;">portlet</span><span style="padding: 0px; margin: 0px;">技术，也不是基于</span><span style="padding: 0px; margin: 0px;">ajax</span><span style="padding: 0px; margin: 0px;">的客户端</span><span style="padding: 0px; margin: 0px;">portal</span><span style="padding: 0px; margin: 0px;">技术。</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">rose poral</span><span style="padding: 0px; margin: 0px;">提供这些特性；</span></p>
  
  <p></p>
<ol style="padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 30px; list-style-position: outside; list-style-type: decimal; list-style-image: initial; margin: 0px;">
  	<li style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px;">能够将一个页面分为多个窗口；</span></li>
  	<li style="padding: 0px; margin: 0px;">
<span style="padding: 0px; margin: 0px;">开发者使用一个主控制器，在主控制器中不断通过</span><span style="padding: 0px; margin: 0px;">portal.addWindow</span><span style="padding: 0px; margin: 0px;">方法，将请求<strong>并发</strong>转发给多个窗口；</span>
</li>
  	<li style="padding: 0px; margin: 0px;">
<span style="padding: 0px; margin: 0px;">每个窗口有单独的控制器处理逻辑、可以返回视图就像一个</span><span style="padding: 0px; margin: 0px;">web</span><span style="padding: 0px; margin: 0px;">请求一样；</span>
</li>
  	<li style="padding: 0px; margin: 0px;">
<span style="padding: 0px; margin: 0px;">框架能够处理<strong>并发转发</strong>、<strong>并发逻辑处理</strong>、<strong>并发渲染</strong>，并最后统一返回把</span><span style="padding: 0px; margin: 0px;">html</span><span style="padding: 0px; margin: 0px;">输出给浏览器；</span>
</li>
  	<li style="padding: 0px; margin: 0px;"><span style="padding: 0px; margin: 0px;">提供了“整体超时控制”手段，使得某个窗口因一时服务能力下降时不影响整个页面的输出；</span></li>
  </ol>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"> </p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">这里有一个</span><span style="padding: 0px; margin: 0px;">portal</span><span style="padding: 0px; margin: 0px;">开发示例：</span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;"><a style="color: #005eac; cursor: pointer; text-decoration: none; padding: 0px; margin: 0px;" href="http://code..com/p/paoding-rose/wiki/Rose_Portal_Demo">http://code..com/p/paoding-rose/wiki/Rose_Portal_Demo</a></span></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"> </p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><span style="padding: 0px; margin: 0px;">献上现在最新的</span><span style="padding: 0px; margin: 0px;">sj</span><span style="padding: 0px; margin: 0px;">主页（</span><span style="padding: 0px; margin: 0px;">2010/6/10 10:46</span><span style="padding: 0px; margin: 0px;">）</span>作为结束，如图6<span style="padding: 0px; margin: 0px;">，目前粉丝 </span>粉丝 21w+、留言146w+，谢谢<span style="padding: 0px; margin: 0px;">（另感谢</span><a style="color: #005eac; cursor: pointer; text-decoration: none; padding: 0px; margin: 0px;" href="http://www.renren.com/profile.do?id=68464" target="_blank">李伟博</a><span style="padding: 0px; margin: 0px;">同学，以上图片均是他收集的）</span>：</p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"> </p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;"><img style="max-width: 550px; padding: 0px; margin: 0px;" src="http://img04.taobaocdn.com/bao/uploaded/i4/T1ITtCXfJiXXa6.tHb_123501.jpg" alt="" width="557" height="402"></p>
  <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 0.8em; margin-left: 0px; padding: 0px;">图6 最新的sj主页</p>
   
  <p><br>原创文章如转载，请注明：转载自<a href="http://www.54chen.com">五四陈科学院</a>[<a href="http://www.54chen.com">http://www.54chen.com</a>] </p>
  <img src="http://chen54.b0.upaiyun.com/wx/wx-2.gif" alt="捐款订阅54chen">
  <br>
  <a href="https://www.54chen.com/donate/">捐赠说明</a>
  </div>
  
  
    <footer>
      <p class="meta">
        
    
  
  <span class="byline author vcard">Posted by <span class="fn">54chen</span></span>
  
        
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2010-06-10T00:00:00+08:00" pubdate data-updated="true">2010-06-10 00:00:00 +0800</time>
        
  
  <span class="categories">
    
      <a class="category" href="/blog/categories/jia-gou-yan-jiu/">架构研究</a>
    
  </span>
  
  
      </p>
      
        <div class="sharing">
    
    
    
  </div>
  
      
      <p class="meta">
        
          </p>
    </footer>
  </article>
  
  </div>
  
  <aside class="sidebar">
    
      
    
  </aside>
  
  
      </div>
    </div>
    <footer role="contentinfo" class="footer_css">  <script src="/javascripts/modernizr-2.0.js"></script>
    <script src="/javascripts/libs/jquery.min.js"></script>
    <script src="/javascripts/octopress.js" type="text/javascript"></script>
    Copyright © 2017 - 54chen -
  
  </footer>
    
  
  
  
  
  
  
  
  
  
  
  </body>
  </html>
