<html class="no-js" lang="en">
<!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <title>人人网－英特尔技术专题讨论会实录 - 五四陈科学院</title>
    <meta name="author" content="54chen">
  
    
    <meta name="description" content="Intel/Qianxiang server workshop
  （这横幅很搞 叫Qianxiang不如叫RenRen，千橡的英文：Oak Pacific）
  intel技术专家
  互联网大客户技术技术服务内容
  1.idc机房相关
  2.性能优化：调试、锁等基础知识 下面由请intel技术专家： …">
    
  
    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  
    
    <link rel="canonical" href="https://www.54chen.com/blog/2009/12/30/everyone-network-intel-technology-symposium-record">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/fkwb.css?v6" type="text/css" rel="stylesheet">  
    <link href="/atom.xml" rel="alternate" title="五四陈科学院" type="application/atom+xml">
    	<link rel="apple-touch-icon" href="touch-icon.png">
  	<link rel="shortcut icon" href="/favicon.ico">
  
    
  
    <style type="text/css">.entry-content table {display: block;width: 100%;overflow: auto;word-break: normal;word-break: keep-all;}.entry-content table th {font-weight: bold;}.entry-content table th,.entry-content table td {padding: 6px 13px;border: 1px solid #ddd;}.entry-content table tr {background-color: #fff;border-top: 1px solid #ccc;}.entry-content table tr:nth-child(2n) {background-color: #f8f8f8;}</style>
  </head>
  
  <body>
    <header role="banner" class="banner_css"><a style="float:left" href="/"><img border="0" src="/images/54chen-logo.gif" alt="五四陈科学院-相信科学，分享技术." title="五四陈科学院-相信科学，分享技术.">
  </a>
  <div>
      <a href="/">首页</a>
      <a href="/blog/archives">归档</a>
      <a href="/video">视频</a>
      <a href="/about">关于</a>
  
      <a href="http://blog.54chen.com" style="color:white;font-size:9px">想找最新内容？</a>
  </div>
  <div class="subscription">
    
  <form action="https://www.54chen.com/cgi" method="get">
    <fieldset role="search">
      
      <input class="search" type="text" name="key" placeholder="Search">
    </fieldset>
  </form>
    
  
  </div>
  
  </header>
    <nav role="navigation"><ul class="subscription" data-subscription="rss">
    <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
    
  </ul>
    
  <form action="https://www.54chen.com/cgi" method="get">
    <fieldset role="search">
      
      <input class="search" type="text" name="key" placeholder="Search">
    </fieldset>
  </form>
    
    <li><a href="/">Blog</a></li>
    <li><a href="/blog/archives">Archives</a></li>
  
  </nav>
    <div id="main">
      <div id="content">
        <div>
  <article class="hentry" role="article">
    
    <header>
      
        <h1 class="entry-title">人人网－英特尔技术专题讨论会实录</h1>
      
      
        <p class="meta">
          
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2009-12-30T00:00:00+08:00" pubdate data-updated="true">2009-12-30 00:00:00 +0800</time>
          
        </p>
      
    </header>
  
  
  <div class="entry-content">
<p>Intel/Qianxiang server workshop<br>
  （这横幅很搞 叫Qianxiang不如叫<a href="http://www.54chen.com/architecture/54-chen-skills-the-whole-point-for-domain-names-using-nginx-and-javascript-to-do-a-simple-jump-to-inform-the-friendly-exchange-of-domain-names.html">RenRen</a>，千橡的英文：Oak Pacific）<br>
  intel技术专家<br>
  互联网大客户技术技术服务内容<br>
  1.idc机房相关<br>
  2.性能优化：调试、锁等基础知识</p>
  
  <p>下面由请intel技术专家：一个阿姨先讲话，可能是，无自我介绍<br>
  数据中心专家：张静、oracle专家津鹏、泰勒、优化组的徐进<br>
  （以上纯音译）</p>
  
  <p>泰勒说话<br>
  性能技术分享
  <a href="http://www.54chen.com/uncategorized/technical-test-you-are-oltp-application-in-the-development-of-pro.html">cpu</a> 至强服务器优化产品</p>
  
  <p>数据中心 Optimized Datacenters</p>
  
  <p>技术专家津鹏开始说话<br>
  国内普通机房2.2kw-3kw每机柜<br>
  放视频：英特尔原料的一个生产厂 现在是一个数据中心 一个三层的楼 （真TM大） 视频里一个老外一层一层地介绍 每机柜30kw（国内的十倍）（听不懂老外在介绍啥，没有字幕，一帮人在看纯视频）</p>
  
  <p>视频放完</p>
  
  <p>在研究散热与机柜</p>
  
  <p>张静开始<br>
  PPT<br>
  数据中心未来的发展和案例分析<br>
  从九六年到零九年的服务器成本的柱状图。power &amp; cooling的费用在增长。<br>
  数据中心：可靠性、可扩容性、管理<br>
  神奇了（第一个大哥讲了半天，第二个大哥上来说PPT是他准备的。。。）</p>
  
  <p>津鹏大哥来说话了<br>
  数据分散<br>
  数据中心要求越高、成本越高、建的时间就越长。<br>
  运营数据中心与灾备数据中心。</p>
  
  <p>张静大哥又回来了<br>
  数据中心的需求与建设的花费的策略：考虑未来几年的增长<br>
  空调的增加更加容易：逐渐投入<br>
  超级用户：类似腾讯，模块化的数据中心建设.集装箱数据中心。快速实施。<br>
  如何在数据中心里节能：PUE Data Center Power Usage Effectiveness<br>
  SPUE<br>
  TPUE = PUE+SPUE<br>
  目前通常在3.2<br>
  一个数据中心基本上只有三分之一是用来计算的。<br>
  1.使用更高效率的电源。80PLUS 铜 银 金<br>
  2.（UPS有三次电源转换：整流器 逆变器 变压器）英特尔在佬实验中取消了<a href="http://www.54chen.com/memo/%e5%9d%90%e9%98%b5%e6%9d%ad%e5%b7%9e%e6%b7%98%e5%ae%9d.html">UPS</a> （高压直流供电）<br>
  3.气流与温度<br>
  冷气流不够 上半部分服务器过热<br>
  风量过大 风速过大 冷空气短路（只有一半的温度降了），下面的解决办法：<br>
  1.封闭冷通道改变冷气流风向 可节能36％ 温差变大后更能节能50％<br>
  2.烟窗式机柜</p>
  
  <p>水冷</p>
  
  <p>打了下瞌睡<br>
  现在是津鹏大哥在讲集装箱机房<br>
  案例：一家佬上市的国内顶级的互联网公司 我猜是百度<br>
  评估一个数据中心的好与坏</p>
  
  <p>最后又是一个视频：的集装箱数据中心 有个<a href="http://www.54chen.com/memo/%e5%9d%90%e9%98%b5%e6%9d%ad%e5%b7%9e%e6%b7%98%e5%ae%9d.html"></a>的兄弟穿个MAIL的Tshirt很cool</p>
  
  <p>津鹏这哥们播视频用的QQ影音</p>
  
  <p>===<br>
  徐进大哥上台，这兄弟来过一回，讲<a href="http://www.54chen.com/_linux_/linux-system-replacement-method-sshd-notes-from-from-academy-of-sciences.html">CPU</a>
  ASE全球对云计算／互联网数据中心的支持<br>
  这兄弟讲课老是晃<br>
  解决性能缺陷：概念和方法及策略<br>
  一个表，按获益排序：1.系统级（网络磁盘内存）  2.应用级（进程堆数据结构）  3.微架构级（微架构级优化指令集） 越前面的策略获益越高 难度越低</p>
  
  <p>intel tools&amp;libraries;<br>
  线程级并行：Thread Building Block Open Standards OpenMP<br>
  数据并行：Ct,C/C++ Stds</p>
  
  <p>2008年的硬件概述<br>
  理论计算能力：102.4G指令／秒<br>
  实际只是三分之一到二分之一，经常是四分之一或者五分之一<br>
  2009年的硬件概述<br>
  理论计算能力：不变<br>
  内存带宽提高了3倍：6通道DDR3：64G／s<br>
  硬盘系统 SSD RAID5＊6： IOPS：100，000（上百倍提升） SSD写性能远差于自己的读性能1：100 但也比传统的高<br>
  SSD随机读性能非常好 随机写一般</p>
  
  <p>BIOS设置：－SMT／EIST／NUMA／Prefetcher<br>
  NUMA:不跨CPU访问内存 尽量不调度原来的CPU上的指令</p>
  
  <p>SSD VS HD<br>
  一般情况下，索引文件都比较大。<br>
  在更新索引文件的过程中，磁盘压力较大，SSD能获得较好性能。</p>
  
  <p>应用级的性能缺陷<br>
  多核环境下，多线程程序的设计需要非常细致的设计<br>
  －锁的粒度<br>
  －并发<br>
  －软件流水线的设计<br>
  －选择合适的线程库（TBB）</p>
  
  <p>锁的粒度<br>
  一个例子，对应用程序内部的缓存加锁造成的线程冲突，将缓存拆分成多个部分，分别加以保护，大大缓解了冲突，应用程序性能提高了21％</p>
  
  <p>典型的应用性能缺陷<br>
  滥用STL：滥用可能会造成非常密集的内存管理作；多线程环境下会更坏<br>
  Glibc的malloc/free在多核环境下扩展性很差、如果在多线程环境下需要频繁分配和释放内存，可以考虑SmartHeap(收费的)\hoard\intel TBB<br>
  内存作：memcpy memset是耗时的，特别是在Xeon E5400平台上，每秒memcpy/memset 2GB将会对整个系统的性能造成极大的影响。<br>
  Bitmap:随机写位图的某些图，如果造成了缓存缺失每次访问都能造成上百个CPU cycle（一个小循环里写10W到20W次，读没有关系）</p>
  
  <p>算法的选择
  <a href="http://www.54chen.com/architecture/wordpress-nginx-php-cgi-mysql-memory-in-the-128m-to-install-and-optimize-the-vps-notes.html">JPEG</a>缩略图生成<br>
  通过在频率域减采样可以将原图非常快的缩小到1／（2的N次方）大小，然后再缩小到合适的大小，与直接缩小相比，性能提高了2.5倍（校内相册吕威大侠曾经说过，我记得是2.8倍）<br>
  加密算法AES VS TEA<br>
  AES比TEA要快3倍以上<br>
  搜索引擎中，为了减少磁盘访问，通常倒排表被压缩后存放，SSE4.2优化后的PForDelta算法可以达到3GB／s的解压速度，是VBYTE速度的10倍，而压缩率更好。</p>
  
  <p>采取正确的IO API<br>
  SSD的IO延迟很小，并且能同时处理几十个IO请求，单线程上的同步IO不能最大化发SSD的性能。<br>
  要SSD发挥到最大，要使用许多个线程去同步作SSD。<br>
  BufferIO会造成内核的内存拷贝，如果需要每秒处理上GB的磁盘读作，则需要考虑是否需要采用Direct-IO mmap等无需拷贝的方式。<br>
  当文件大于系统内存的情况下，通过mmap的方式随机的访问会造成频繁缺页。</p>
  
  <p>采用高性能库函数<br>
  intel ipp库：<a href="http://www.54chen.com/cc/php-java-c-upload-files-how-to-accurately-determine-the-file-type-mime-literacy.html">JPEG</a> resize IPP是libjpeg的2部<br>
  Westmere上新的AES指令可以提供10倍于普通AES的性能，IPP将会在第一时间提供支持。</p>
  
  <p>例子：用SSE4.2优化P_FOR_dELTA解压缩 很复杂 看不懂</p>
  
  <p>＝＝＝<br>
  四个内部案例<br>
  分享时间：小白 铁安 军辉</p>
  
  <p>passport优化 小白</p>
  
  <p>以前的情况<br>
  read-&gt;mysql-&gt;loginCache-&gt;write<br>
  Ice.Server.ThreadPool<br>
  第三个阶段非常慢，用户登录不上。</p>
  
  <p>现在<br>
  read<br>
  Ice.Server.ThreadPool<br>
  mysql-&gt;loginCache-&gt;write<br>
  另一个pool</p>
  
  <p>延长二十分钟在线，从产品上解决问题。</p>
  
  <p>新鲜事重构 铁安<br>
  文件存储<br>
  索引存储4－5W写入每秒<br>
  每秒中用户产生的feed有500条左右，这500条需要发给特定的一群人，平均分给一百人，每秒大概5W</p>
  
  <p>SearchCache  全站用户数据全缓存服务 长青<br>
  以struct形式存储用户，一个亿的用户会占65.2G内存，不包括内存碎片等实际开销。<br>
  去掉struct的内存结构化开销，通过序列化反序列化来压缩内存占用。<br>
  内存优化比例大概在40－70％之间。</p>
  
  <p>锁的效率 军辉<br>
  原子作效率最好<br>
  自旋锁的效率还不错<br>
  hash函数：boobs（memcache里的） 性能和均匀程度最好的是murmur stdhash是最不好的<br>
  其他经验：<br>
  一个锁有严重的效率问题<br>
  锁的数目在并发线程数的10部时最好<br>
  pthread spinlock有效率问题 争用发生时延迟达5－10ms<br>
  spinlock的cpu消耗比mutex低<br>
  实现lockfree需要抛弃一些特性</p>
  
  <p>专家说明：spinlock使用时可能会cpu特高，用的时候小心。</p>
   
  <p><br>原创文章如转载，请注明：转载自<a href="http://www.54chen.com">五四陈科学院</a>[<a href="http://www.54chen.com">http://www.54chen.com</a>] </p>
  <img src="http://chen54.b0.upaiyun.com/wx/wx-2.gif" alt="捐款订阅54chen">
  <br>
  <a href="https://www.54chen.com/donate/">捐赠说明</a>
  </div>
  
  
    <footer>
      <p class="meta">
        
    
  
  <span class="byline author vcard">Posted by <span class="fn">54chen</span></span>
  
        
  
  
  
  
  
  
  
  
    
  
  
  
  <time datetime="2009-12-30T00:00:00+08:00" pubdate data-updated="true">2009-12-30 00:00:00 +0800</time>
        
  
  <span class="categories">
    
      <a class="category" href="/blog/categories/linux/">linux</a>
    
  </span>
  
  
      </p>
      
        <div class="sharing">
    
    
    
  </div>
  
      
      <p class="meta">
        
          <a class="basic-alignment right" href="/blog/2009/12/31/zero-90-xian-shell-script-sacrificed-server-batch-operations/" title="Next Post: ［零九零献］献出服务器批量作shell脚本">［零九零献］献出服务器批量作shell脚本 »</a>
        
      </p>
    </footer>
  </article>
  
  </div>
  
  <aside class="sidebar">
    
      
    
  </aside>
  
  
      </div>
    </div>
    <footer role="contentinfo" class="footer_css">  <script src="/javascripts/modernizr-2.0.js"></script>
    <script src="/javascripts/libs/jquery.min.js"></script>
    <script src="/javascripts/octopress.js" type="text/javascript"></script>
    Copyright © 2017 - 54chen -
  
  </footer>
    
  
  
  
  
  
  
  
  
  
  
  </body>
  </html>
